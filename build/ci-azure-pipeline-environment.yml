trigger:
- master
pr:
 branches:
   include:
     - master
 paths:
   include:
     - azure-pipeline-environment/*

pool:
  vmImage: 'ubuntu-latest'
steps:
- task: HelmInstaller@1
  displayName: 'Install Helm'
  inputs:
    helmVersionToInstall: 'latest'

- script: helm lint ./azure-pipeline-environment/
  displayName: 'Lint Helm chart'

- script: kind create cluster --name ci
  displayName: Start Kind cluster

- script: helm install ./azure-pipeline-environment/ --generate-name --dry-run
  displayName: 'Dry-run Install of Helm chart on Kind cluster'

- script: helm install ./azure-pipeline-environment/ --generate-name
  displayName: 'Dry-run Install of Helm chart on Kind cluster'
